upstream backend {
  server node:3000;
}

upstream filehosting_messages {
  server filehosting-messages:3001;
}

server {
  listen 80;
  server_name localhost;

  # Security headers
  include snippets/security-headers.conf;

  # Gzip compression
  include snippets/gzip.conf;

  # Proxy configuration
  include snippets/proxy.conf;

  location /api {
    proxy_pass http://backend;
  }

  location /messages/ {
    proxy_pass http://filehosting_messages/;
  }

  # Error pages
  error_page 500 502 503 504 /50x.html;
  location = /50x.html {
    root /usr/share/nginx/html;
  }
}
